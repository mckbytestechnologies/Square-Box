<section class="properties">
    <div class="container">
        <h2 class="section-title justify-content-center align-items-center" id="dynamic-title">
            {% if selected_city %}
                Premium Properties in {{ selected_city }}
            {% else %}
                Featured Real Estate Projects
            {% endif %}
        </h2>
        
        <!-- Slider container for more than 4 properties -->
        <div class="properties-slider-container" id="slider-container" style="display: none;">
            <div class="swiper properties-slider">
                <div class="swiper-wrapper">
                    {% for property in property %}
                    <div class="swiper-slide" data-city="{{ property.city }}" data-type="{{ property.listing_type }}">
                        <a href="{% url 'mck_website:property_detail' property.id %}" class="property-card-link">
                            <div class="property-card">
                                <div class="property-img">
                                    {% for img in property.images.all|slice:":1" %}
                                        <img src="{{ img.image.url }}" alt="{{ property.title }}">
                                    {% endfor %}
                                    <div class="property-badge">
                                        <span class="badge-type {% if property.property_type.name %}badge-{{ property.property_type.name|lower }}{% endif %}">
                                            <i class="fas 
                                                {% if property.property_type.name == 'APARTMENT' %}fa-building
                                                {% elif property.property_type.name == 'VILLA' %}fa-home
                                                {% elif property.property_type.name == 'PLOT' %}fa-vector-square
                                                {% elif property.property_type.name == 'COMMERCIAL' %}fa-store
                                                {% elif property.property_type.name == 'INDEPENDENT_HOUSE' %}fa-house-user
                                                {% elif property.property_type.name == 'TOWNHOUSE' %}fa-city
                                                {% else %}fa-home{% endif %}">
                                            </i>
                                            {{ property.property_type.name|default:"Premium"|title }}
                                        </span>
                                        {% if property.is_featured %}
                                            <span class="badge-featured">Featured</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="property-info">
                                    <div class="property-content">
                                        <h3>{{ property.title|default:"Premium Property" }}</h3>
                                        {% if property.price %}
                                            <p class="property-price">₹{{ property.price|floatformat:"0" }}</p>
                                        {% endif %}
                                        <p class="property-address">{{ property.description }}</p>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        </div>

        <!-- Grid layout for 4 or fewer properties -->
        <div class="properties-grid" id="grid-container">
            {% for property in property %}
            <a href="{% url 'mck_website:property_detail' property.id %}" class="property-card-link">
                <div class="property-card" data-city="{{ property.city }}" data-type="{{ property.property_type.name }}">
                    <div class="property-img">
                        {% for img in property.images.all|slice:":1" %}
                            <img src="{{ img.image.url }}" alt="{{ property.title }}">
                        {% endfor %}
                        <div class="property-badge">
                            <span class="badge-type {% if property.property_type.name %}badge-{{ property.property_type.name|lower }}{% endif %}">
                                <i class="fas 
                                    {% if property.property_type.name == 'APARTMENT' %}fa-building
                                    {% elif property.property_type.name == 'VILLA' %}fa-home
                                    {% elif property.property_type.name == 'PLOT' %}fa-vector-square
                                    {% elif property.property_type.name == 'COMMERCIAL' %}fa-store
                                    {% elif property.property_type.name == 'INDEPENDENT_HOUSE' %}fa-house-user
                                    {% elif property.property_type.name == 'TOWNHOUSE' %}fa-city
                                    {% else %}fa-home{% endif %}">
                                </i>
                                {{ property.property_type.name|default:"Premium"|title }}
                            </span>
                            {% if property.is_featured %}
                                <span class="badge-featured">Featured</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="property-info">
                        <div class="property-content">
                            <h3>{{ property.title|default:"Premium Property" }}</h3>
                            {% if property.price %}
                                <p class="property-price">₹{{ property.price|floatformat:"0" }}</p>
                            {% endif %}
                            <p class="property-address">{{ property.description }}</p>
                            <div class="property-details">
                                {% with pt=property.property_type.name %}
                                {% if pt == 'APARTMENT' %}
                                    {% if property.bedrooms %}<span><i class="fas fa-bed"></i> {{ property.bedrooms }} Beds</span>{% endif %}
                                    {% if property.bathrooms %}<span><i class="fas fa-bath"></i> {{ property.bathrooms }} Baths</span>{% endif %}
                                    {% if property.sqft %}<span><i class="fas fa-ruler-combined"></i> {{ property.sqft }} sq.ft</span>{% endif %}
                                {% elif pt == 'VILLA' %}
                                    {% if property.plot_area %}<span>Plot Area: {{ property.plot_area }} sq.ft</span>{% endif %}
                                    {% if property.builtup_area %}<span>Built-up: {{ property.builtup_area }} sq.ft</span>{% endif %}
                                {% elif pt == 'PLOT' %}
                                    {% if property.plot_length and property.plot_width %}<span>Plot: {{ property.plot_length }} x {{ property.plot_width }} ft</span>{% endif %}
                                {% endif %}
                                {% endwith %}
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="no-properties">
                <div class="empty-state">
                    <i class="fas fa-home fa-3x"></i>
                    <h4 id="empty-state-title">
                        {% if selected_city %}
                            Currently no properties in {{ selected_city }}
                        {% else %}
                            No properties available
                        {% endif %}
                    </h4>
                    <p>Please check back later or contact our agents</p>
                    <a href="" class="btn-contact">Contact Us</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<style>
.property-card-link {
    text-decoration: none;
    color: inherit;
    display: block;
}

/* Property Card */
.property-card {
     min-height: 320px;  /* reduce minimum height */
    height: auto;  
    display: flex;
    flex-direction: column;
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    min-height: 400px;
    max-width: 380px;
    margin: auto;
    cursor: pointer;
}
.property-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.15);
}

/* Image */
.property-img {
    height: 220px;
    width: 100%;
    position: relative;
    overflow: hidden;
}
.property-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
}
.property-card:hover .property-img img {
    transform: scale(1.05);
}
.property-img::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 40%;
    background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
}

/* Badges */
.property-badge {
    position: absolute;
    top: 15px;
    left: 15px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 2;
}
.badge-type,
.badge-featured {
    padding: 6px 14px;
    border-radius: 50px;
    font-size: 12px;
    font-weight: 600;
    color: #0a0a0a;
    display: flex;
    align-items: center;
    gap: 6px;
}
.badge-type { background: linear-gradient(135deg, #ffbf00, #ffdf47); }
.badge-featured { background: linear-gradient(135deg, #e74c3c, #ff7676); }

/* Info */
.property-info {
    flex: 1;
    padding: 15px 20px;
    display: flex;
    flex-direction: column;
}
.property-content {
    flex: 1;
    overflow: hidden;
}
.property-info h3 {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 5px;
    color: #2c3e50;
}
.property-price {
    font-size: 18px;
    font-weight: 700;
    color: #e74c3c;
    margin-bottom: 8px;
}
.property-address {
    font-size: 14px;
    color: #7f8c8d;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 10px;
}
.property-details {
    font-size: 13px;
    color: #555;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}
.property-details span {
    background: #f5f7fa;
    border-radius: 6px;
    padding: 4px 6px;
    display: flex;
    align-items: center;
    gap: 4px;
}
.property-details i {
    color: #f3f725;
    font-size: 14px;
}
/* Swiper Navigation Arrows */
.swiper-button-next,
.swiper-button-prev {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #fff;
    color: #050505;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    font-size: 18px;
}

/* Hover Effect */
.swiper-button-next:hover,
.swiper-button-prev:hover {
    background: #070707;
    color: #fff;
    transform: scale(1.1);
    box-shadow: 0 6px 14px rgba(0,0,0,0.2);
}

/* Position Tweaks */
.swiper-button-next {
    right: 15px;
}
.swiper-button-prev {
    left: 15px;
}

/* Adjust default icon size */
.swiper-button-next::after,
.swiper-button-prev::after {
    font-size: 18px;
    font-weight: bold;
}

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sliderContainer = document.querySelector('.properties-slider-container');
    const gridContainer = document.querySelector('.properties-grid');
    const propertyCards = document.querySelectorAll('.property-card');
    const filterButtons = document.querySelectorAll('.filter-btn');
    let propertiesSwiper = null;
    
    if (propertyCards.length > 4) {
        sliderContainer.style.display = 'block';
        gridContainer.style.display = 'none';
        propertiesSwiper = new Swiper('.properties-slider', {
            slidesPerView: 1,
            spaceBetween: 20,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            pagination: { el: '.swiper-pagination', clickable: true },
            breakpoints: {
                640: { slidesPerView: 2, spaceBetween: 20 },
                768: { slidesPerView: 3, spaceBetween: 25 },
                1024: { slidesPerView: 4, spaceBetween: 30 },
            },
        });
    } else {
        sliderContainer.style.display = 'none';
        gridContainer.style.display = 'grid';
    }

    if (filterButtons.length) {
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                const type = this.dataset.type;
                let visibleCount = 0;
                propertyCards.forEach(card => {
                    if (type === 'all' || card.dataset.type === type) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                const emptyState = document.querySelector('.no-properties');
                if (emptyState) {
                    emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
                }
                if (propertiesSwiper) propertiesSwiper.update();
            });
        });
    }

    window.addEventListener('resize', function() {
        if (propertiesSwiper) propertiesSwiper.update();
    });
});
</script>
