<!-- Top Announcement Bar -->
<div class="announce" id="announceBar" role="region" aria-label="Announcement">
  <div class="announce__track">
    Vellore's No.1 Real Estate Platform • Find Homes, Plots & Commercial Spaces • Trusted Agents • Verified Listings • Secure Deals •
    Mumbai's No.1 Real Estate Platform • Find Homes, Plots & Commercial Spaces • Trusted Agents • Verified Listings • Secure Deals •
  </div>
  <button class="announce__close" id="announceClose" aria-label="Close announcement">
    <i class="fas fa-times" aria-hidden="true"></i>
  </button>
</div>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="container nav-inner">
    <!-- Logo -->
    <a class="logo" href="{% url 'mck_website:home_page' %}" aria-label="Homepage">
      <div class="logo-mark">SB</div>
      <div class="logo-text">
        Square<span class="highlight">Box</span>
      </div>
    </a>

    <!-- Desktop Nav -->
    <ul class="nav desktop-nav" role="menubar" aria-label="Primary">
      <!-- Buy Dropdown -->
      <li class="nav-dropdown">
        <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale" role="menuitem" aria-haspopup="true" class="dropdown-toggle">Buy </a>
        <div class="dropdown" role="menu">
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Apartment">Apartments</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Independent_House">Independent House</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Villa">Villa</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Plot">Plot / Land</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Commercial">Commercial Property</a>
          <a href="{% url 'mck_website:mck_property_page' %}">New Launch</a>
        </div>
      </li>
      
      <!-- Rent Dropdown -->
      <li class="nav-dropdown">
        <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent" role="menuitem" aria-haspopup="true" class="dropdown-toggle">Rent </a>
        <div class="dropdown" role="menu">
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Apartment">Apartments</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Independent_House">Independent House</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Villa">Villa</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Plot">Plot / Land</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Commercial">Commercial Property</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&status=New Launch">New Launch</a>
        </div>
      </li>
      
      <li><a href="{% url 'mck_website:mck_property_create_page' %}">Sell</a></li>
      
      <!-- Services Dropdown -->
      <li class="nav-dropdown">
        <a href="#" aria-haspopup="true" class="dropdown-toggle">Services </a>
        <div class="dropdown" role="menu">
          <a href="{% url 'mck_website:property_legal_services_page' %}">Property Legal Services</a>
          <a href="{% url 'mck_website:land_levelling_page' %}">Land Levelling</a>
          <a href="{% url 'mck_website:fencing_page' %}">Fencing</a>
          <a href="{% url 'mck_website:solar_page' %}">Solar Roadmap</a>
        </div>
      </li>
      
      <li><a href="{% url 'mck_website:property_maintenance_page' %}"> Property Maintenance</a></li>
    </ul>

    <!-- User Authentication Section - Desktop -->
    <div class="user-auth desktop-auth">
      {% if user.is_authenticated %}
        <!-- User is logged in - Show profile dropdown -->
        <div class="user-dropdown">
          <button class="user-btn" aria-expanded="false" aria-label="User menu">
            <i class="fas fa-user-circle"></i>
            <span class="user-name">{{ user.first_name|default:user.username }}</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="user-menu" role="menu">
            
            <div class="user-menu-divider"></div>
            <a href="{% url 'mck_auth:website_logout' %}" role="menuitem" class="logout-btn">
              <i class="fas fa-sign-out-alt"></i>Logout
            </a>
          </div>
        </div>
      {% else %}
        <!-- User is not logged in - Show login/register buttons -->
        <div class="auth-buttons">
          <a href="{% url 'mck_auth:website_signin' %}" class="auth-btn login-btn">
            <i class="fas fa-sign-in-alt"></i>Login
          </a>
          <a href="{% url 'mck_auth:website_signup' %}" class="auth-btn register-btn">
            <i class="fas fa-user-plus"></i>Register
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Hamburger (Mobile Only) -->
    <button class="hamburger" aria-label="Open menu" id="openMobileNav">☰</button>
  </div>
</nav>

<!-- Mobile Nav Drawer -->
<div class="mobile-nav-drawer" id="mobileNavDrawer">
  <div class="mobile-nav-content">
    <!-- Close Button -->
    <button class="mobile-close-btn" id="closeMobileNav" aria-label="Close menu">✕</button>

    <!-- Mobile Logo -->
    <div class="mobile-logo">
      <div class="logo-mark text-dark">SB</div>
      <div class="logo-text">
        Square<span class="highlight">Box</span>
      </div>
    </div>

    <!-- Mobile User Auth Section -->
    <div class="mobile-auth-section">
      {% if user.is_authenticated %}
        <div class="mobile-user-info">
          <i class="fas fa-user-circle"></i>
          <div>
            <div class="mobile-user-name">{{ user.first_name|default:user.username }}</div>
            <div class="mobile-user-email">{{ user.email }}</div>
          </div>
        </div>
        <div class="mobile-auth-links">
          
          <a href="{% url 'mck_auth:website_logout' %}" class="mobile-auth-link logout-link">
            <i class="fas fa-sign-out-alt"></i>Logout
          </a>
        </div>
      {% else %}
        <!-- Login/Register buttons inside mobile menu -->
        <div class="mobile-auth-header">
          <h3>Account</h3>
        </div>
        <div class="mobile-auth-buttons">
          <a href="{% url 'mck_auth:website_signin' %}" class="mobile-auth-btn login-btn">
            <i class="fas fa-sign-in-alt"></i>Login
          </a>
          <a href="{% url 'mck_auth:website_signup' %}" class="mobile-auth-btn register-btn">
            <i class="fas fa-user-plus"></i>Register
          </a>
        </div>
      {% endif %}
    </div>

    <div class="mobile-nav-menu">
      <!-- Buy Dropdown -->
      <div class="mobile-nav-item">
        <button class="mobile-nav-toggle" data-target="buy-dropdown">
          Buy <i class="fas fa-chevron-down"></i>
        </button>
        <div class="mobile-nav-dropdown" id="buy-dropdown">
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Apartment">Apartments</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Independent_House">Independent House</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Villa">Villa</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Plot">Plot / Land</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=sale&property_type=Commercial">Commercial Property</a>
          <a href="{% url 'mck_website:mck_property_page' %}">New Launch</a>
        </div>
      </div>

      <!-- Rent Dropdown -->
      <div class="mobile-nav-item">
        <button class="mobile-nav-toggle" data-target="rent-dropdown">
          Rent <i class="fas fa-chevron-down"></i>
        </button>
        <div class="mobile-nav-dropdown" id="rent-dropdown">
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Apartment">Apartments</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Independent_House">Independent House</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Villa">Villa</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Plot">Plot / Land</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&property_type=Commercial">Commercial Property</a>
          <a href="{% url 'mck_website:mck_property_page' %}?listing_type=rent&status=New Launch">New Launch</a>
        </div>
      </div>

      <!-- Sell -->
      <a class="mobile-nav-link" href="{% url 'mck_website:mck_property_create_page' %}">Sell</a>

      <!-- Services Dropdown -->
      <div class="mobile-nav-item">
        <button class="mobile-nav-toggle" data-target="services-dropdown">
          Services <i class="fas fa-chevron-down"></i>
        </button>
        <div class="mobile-nav-dropdown" id="services-dropdown">
          <a href="{% url 'mck_website:property_legal_services_page' %}">Property Legal Services</a>
          <a href="{% url 'mck_website:land_levelling_page' %}">Land Levelling</a>
          <a href="{% url 'mck_website:property_maintenance_page' %}">Property Management</a>
          <a href="{% url 'mck_website:fencing_page' %}">Fencing</a>
          <a href="{% url 'mck_website:solar_page' %}">Solar Roadmap</a>
        </div>
      </div>

      <!-- Maintenance -->
      <a class="mobile-nav-link" href="{% url 'mck_website:property_maintenance_page' %}">Maintenance</a>
    </div>
  </div>
</div>

<style>
  /* Navbar Dropdown Styles */
  .nav-dropdown {
    position: relative;
  }
  
  .nav-dropdown:hover .dropdown {
    display: block;
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    padding: 0.5rem;
    min-width: 200px;
    display: none;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.3s ease;
    z-index: 1000;
  }
  
  .dropdown a {
    display: block;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: #333;
    border-radius: 4px;
    transition: background 0.3s ease;
  }
  
  .dropdown a:hover {
    background: #f5f5f5;
  }
  
  /* Desktop Authentication Styles */
  .desktop-auth {
    display: flex;
    align-items: center;
    margin-left: auto;
    padding-right: 1rem;
  }

  .auth-buttons {
    display: flex;
    gap: 0.5rem;
  }

  .auth-btn {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .login-btn {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
  }

  .login-btn:hover {
    background: var(--primary);
    color: white;
  }

  .register-btn {
    background: var(--primary);
    border: 2px solid var(--primary);
    color: white;
  }

  .register-btn:hover {
    background: transparent;
    color: var(--primary);
  }
  
  /* User Dropdown Styles */
  .user-dropdown {
    position: relative;
  }

  .user-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: transparent;
    border: 2px solid var(--primary);
    border-radius: 6px;
    color: var(--primary);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .user-btn:hover {
    background: var(--primary);
    color: white;
  }

  .user-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    padding: 0.5rem;
    min-width: 200px;
    display: none;
    z-index: 1000;
  }

  .user-dropdown:hover .user-menu {
    display: block;
  }

  .user-menu a {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: #333;
    border-radius: 4px;
    transition: background 0.3s ease;
  }

  .user-menu a:hover {
    background: #f5f5f5;
  }

  .user-menu-divider {
    height: 1px;
    background: #eee;
    margin: 0.25rem 0;
  }

  .logout-btn {
    color: #dc3545 !important;
  }

  .logout-btn:hover {
    background: #ffe6e6 !important;
  }
  
  /* Mobile Nav Drawer */
  .mobile-nav-drawer {
    position: fixed;
    top: 0;
    right: -100%;
    width: 300px;
    height: 100vh;
    background: #2c3e50;
    z-index: 10000;
    transition: right 0.3s ease;
    overflow-y: auto;
  }
  
  .mobile-nav-drawer.active {
    right: 0;
  }
  
  .mobile-nav-content {
    padding: 1rem;
    position: relative;
  }
  
  .mobile-close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    z-index: 10001;
  }
  
  .mobile-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 0;
    margin-bottom: 1rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  
  .logo-mark {
    width: 40px;
    height: 40px;
    background: var(--primary);
    color: rgb(5, 5, 5);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1.2rem;
  }
  
  .logo-text {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
  }
  
  .logo-text .highlight {
    color: var(--primary);
  }
  
  .mobile-nav-menu {
    margin-top: 1rem;
  }
  
  .mobile-nav-item {
    margin-bottom: 0.5rem;
  }
  
  .mobile-nav-toggle {
    width: 100%;
    text-align: left;
    background: rgba(255,255,255,0.1);
    border: none;
    padding: 1rem;
    color: white;
    font-weight: 600;
    cursor: pointer;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .mobile-nav-toggle.active {
    background: rgba(255,255,255,0.2);
  }
  
  .mobile-nav-dropdown {
    display: none;
    padding: 0.5rem 0 0.5rem 1.5rem;
  }
  
  .mobile-nav-dropdown.active {
    display: block;
  }
  
  .mobile-nav-dropdown a {
    display: block;
    padding: 0.75rem;
    color: #e7f1fb;
    text-decoration: none;
    border-radius: 4px;
    transition: background 0.3s ease;
  }
  
  .mobile-nav-dropdown a:hover {
    background: rgba(255,255,255,0.1);
  }
  
  .mobile-nav-link {
    display: block;
    padding: 1rem;
    color: white;
    text-decoration: none;
    font-weight: 600;
    border-radius: 6px;
    transition: background 0.3s ease;
  }
  
  .mobile-nav-link:hover {
    background: rgba(255,255,255,0.1);
  }
  
  /* Overlay for mobile menu */
  .mobile-nav-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    display: none;
  }
  
  .mobile-nav-overlay.active {
    display: block;
  }
  
  /* Mobile Auth Section */
  .mobile-auth-section {
    padding: 1rem 0;
    margin-bottom: 1rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  
  .mobile-auth-header {
    margin-bottom: 1rem;
  }
  
  .mobile-auth-header h3 {
    color: white;
    font-size: 1.2rem;
    margin: 0;
  }
  
  .mobile-user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-bottom: 1rem;
  }
  
  .mobile-user-info i {
    font-size: 2rem;
    color: var(--primary);
  }
  
  .mobile-user-name {
    font-weight: 600;
    color: white;
  }
  
  .mobile-user-email {
    font-size: 0.9rem;
    color: #ccc;
  }
  
  .mobile-auth-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .mobile-auth-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: #e7f1fb;
    text-decoration: none;
    border-radius: 6px;
    transition: background 0.3s ease;
  }
  
  .mobile-auth-link:hover {
    background: rgba(255,255,255,0.1);
  }
  
  .logout-link {
    color: #ff6b6b !important;
  }
  
  .mobile-auth-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .mobile-auth-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .mobile-auth-btn.login-btn {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
  }
  
  .mobile-auth-btn.login-btn:hover {
    background: var(--primary);
    color: white;
  }
  
  .mobile-auth-btn.register-btn {
    background: var(--primary);
    border: 2px solid var(--primary);
    color: white;
  }
  
  .mobile-auth-btn.register-btn:hover {
    background: transparent;
    color: var(--primary);
  }
  
  /* Announcement bar close button styles */
  .announce__close {
    position: absolute;
    right: .75rem;
    top: 50%;
    transform: translateY(-50%);
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #e7d20eff, #070707ff);
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transition: transform .25s ease, box-shadow .25s ease, background .3s ease;
    line-height: 1;
    padding: 0;
  }
  
  .announce__close i {
    display: inline-block;
    font-size: 18px;
    line-height: 1;
    margin: 0;
    pointer-events: none;
  }
  
  .announce__close:hover {
    background: linear-gradient(135deg, #070707ff, #504f4fff);
    transform: translateY(-50%) scale(1.15) rotate(10deg);
    box-shadow: 0 6px 14px rgba(0,0,0,0.25), 0 0 10px rgba(255, 92, 138, 0.5);
  }
  
  .announce__close:hover i {
    transform: rotate(90deg);
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .desktop-auth {
      display: none;
    }
    
    .hamburger {
      display: block;
    }
  }
  
  @media (min-width: 769px) {
    .hamburger {
      display: none;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Announcement bar close functionality
    const announceBar = document.getElementById('announceBar');
    const announceClose = document.getElementById('announceClose');

    if (announceClose) {
        announceClose.addEventListener('click', function() {
            announceBar.style.display = 'none';
        });
    }

    // Mobile menu functionality
    const openMobileNav = document.getElementById('openMobileNav');
    const closeMobileNav = document.getElementById('closeMobileNav');
    const mobileNavDrawer = document.getElementById('mobileNavDrawer');
    const mobileNavOverlay = document.createElement('div');
    mobileNavOverlay.className = 'mobile-nav-overlay';
    document.body.appendChild(mobileNavOverlay);

    // Open mobile menu
    if (openMobileNav) {
        openMobileNav.addEventListener('click', function() {
            mobileNavDrawer.classList.add('active');
            mobileNavOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    }

    // Close mobile menu
    function closeMobileMenu() {
        mobileNavDrawer.classList.remove('active');
        mobileNavOverlay.classList.remove('active');
        document.body.style.overflow = 'auto';
        
        // Close all dropdowns
        document.querySelectorAll('.mobile-nav-dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
        });
        
        document.querySelectorAll('.mobile-nav-toggle').forEach(toggle => {
            toggle.classList.remove('active');
        });
    }

    if (closeMobileNav) {
        closeMobileNav.addEventListener('click', closeMobileMenu);
    }

    // Close mobile menu when clicking outside
    mobileNavOverlay.addEventListener('click', closeMobileMenu);

    // Mobile dropdown toggles
    const mobileToggles = document.querySelectorAll('.mobile-nav-toggle');
    mobileToggles.forEach(toggle => {
        toggle.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const targetDropdown = document.getElementById(targetId);
            
            // Toggle active class
            this.classList.toggle('active');
            targetDropdown.classList.toggle('active');
            
            // Close other dropdowns
            document.querySelectorAll('.mobile-nav-dropdown').forEach(dropdown => {
                if (dropdown.id !== targetId) {
                    dropdown.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.mobile-nav-toggle').forEach(otherToggle => {
                if (otherToggle !== toggle) {
                    otherToggle.classList.remove('active');
                }
            });
        });
    });

    // Desktop dropdown functionality
    const navDropdowns = document.querySelectorAll('.nav-dropdown');
    
    navDropdowns.forEach(dropdown => {
        dropdown.addEventListener('mouseenter', function() {
            const menu = this.querySelector('.dropdown');
            menu.style.display = 'block';
            setTimeout(() => {
                menu.style.opacity = '1';
                menu.style.visibility = 'visible';
                menu.style.transform = 'translateY(0)';
            }, 10);
        });
        
        dropdown.addEventListener('mouseleave', function() {
            const menu = this.querySelector('.dropdown');
            menu.style.opacity = '0';
            menu.style.visibility = 'hidden';
            menu.style.transform = 'translateY(10px)';
            setTimeout(() => {
                menu.style.display = 'none';
            }, 300);
        });
    });

    // User dropdown functionality for desktop
    const userBtn = document.querySelector('.user-btn');
    const userMenu = document.querySelector('.user-menu');
    
    if (userBtn && userMenu) {
        userBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            const isExpanded = userBtn.getAttribute('aria-expanded') === 'true';
            userBtn.setAttribute('aria-expanded', String(!isExpanded));
            userMenu.style.display = isExpanded ? 'none' : 'block';
        });

        // Close user menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-dropdown')) {
                userBtn.setAttribute('aria-expanded', 'false');
                userMenu.style.display = 'none';
            }
        });
    }
});
</script>