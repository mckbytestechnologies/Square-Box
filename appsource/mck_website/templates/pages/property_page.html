{% extends "layouts/base.html" %}
{% load static %}
{% load query_transform %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SquareBox Properties | Find Your Dream Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FFD700;
            --primary-dark: #D4AF37;
            --secondary: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --text: #334155;
            --text-light: #64748b;
            --success: #10b981;
            --border: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9fafb;
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        .header {
            background: white;
            box-shadow: var(--shadow);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--secondary);
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-links a.active {
            color: var(--primary);
            font-weight: 600;
        }

        /* Hero Banner */
        .hero-banner {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1973&q=80') no-repeat center center/cover;
            padding: 80px 0;
            color: white;
            text-align: center;
            margin-bottom: 40px;
        }

        .hero-banner h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
        }

        .hero-banner p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }

        /* Main Content Layout */
        .main-content {
            display: flex;
            gap: 30px;
            margin-bottom: 60px;
        }

        /* Filter Sidebar */
        .filter-sidebar {
            flex: 0 0 300px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 25px;
            height: fit-content;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .filter-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .reset-filters {
            color: var(--primary);
            font-size: 0.9rem;
            cursor: pointer;
        }

        .filter-group {
            margin-bottom: 25px;
        }

        .filter-group h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .price-range {
            margin-top: 10px;
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-item input {
            width: 18px;
            height: 18px;
        }

        .option-item label {
            cursor: pointer;
        }

        .filter-button {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-button:hover {
            background: var(--primary-dark);
        }

        /* Property Listings */
        .property-listings {
            flex: 1;
        }

        .listings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .listings-header h2 {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .sort-by {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sort-by select {
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: white;
        }

        .view-options {
            display: flex;
            gap: 10px;
        }

        .view-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .property-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .property-image {
            height: 200px;
            overflow: hidden;
            position: relative;
        }

        .property-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .property-card:hover .property-image img {
            transform: scale(1.05);
        }

        .property-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .badge-type {
            padding: 6px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .badge-featured {
            padding: 6px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            background: var(--secondary);
            color: white;
        }

        .property-content {
            padding: 20px;
        }

        .property-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .property-location {
            color: var(--text-light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .property-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: black;
            margin-bottom: 15px;
        }

        .property-details {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        .detail {
            text-align: center;
        }

        .detail i {
            color: #2563eb;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .detail span {
            display: block;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .property-actions {
            display: flex;
            gap: 12px;
        }

        .inquire-btn{
            flex: 1;
            padding: 12px;
            background-color: var(--primary);
            color: rgb(8, 8, 8);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            transition: var(--transition);
            font-size: 0.9rem;
            border: none;
            cursor: pointer;
        }
        .inquire-btn:hover {
            background-color: var(--primary-dark);
        }

        .view-details {
            flex: 1;
            padding: 12px;
            background-color: var(--primary);
            color: rgb(8, 8, 8);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .view-details:hover {
            background-color: var(--primary-dark);
        }

        .favorite-btn {
            width: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgb(14, 14, 14);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .favorite-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 40px;
            gap: 10px;
        }

        .page-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            text-decoration: none;
            transition: var(--transition);
        }

        .page-item.active {
            background: var(--primary);
            color: rgb(10, 10, 10);
            border-color: var(--primary);
        }

        .page-item:hover {
            border-color: var(--primary);
            color: rgb(10, 10, 10);
        }

         /* Why Choose Us */
        .why-choose-us {
            padding: 80px 0;
            background: white;
        }

        .why-choose-us h2 {
            text-align: center;
            margin-bottom: 50px;
            font-size: 2.5rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .feature {
            text-align: center;
            padding: 30px;
        }

        .feature i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .feature h3 {
            margin-bottom: 15px;
            color: var(--dark);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .filter-sidebar {
                flex: 1;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .hero-banner h1 {
                font-size: 2.2rem;
            }
            
            .listings-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .properties-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                display: none;
            }
        }
         /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: var(--dark);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: var(--dark);
            color: white;
        }
         .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
    }
    
    .error-message {
      display: none;
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
    }
    
    .no-properties {
        text-align: center;
        padding: 40px;
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
    }
    
    .no-properties i {
        font-size: 3rem;
        color: var(--text-light);
        margin-bottom: 20px;
    }
    
    .no-properties h3 {
        margin-bottom: 15px;
        color: var(--dark);
    }

    </style>
</head>
<body>
    
    <!-- Main Content -->
    <div class="container mt-5">
        <div class="main-content">
            <!-- Filter Sidebar -->
            <div class="filter-sidebar">
    <div class="filter-header">
        <h2>Filters</h2>
        <span class="reset-filters" onclick="resetFilters()">Reset All</span>
    </div>

    <form method="GET" action="{% url 'mck_website:mck_property_page' %}" id="sidebarFilters">

        <!-- City Search -->
        <div class="filter-group">
            <h3>Search by City</h3>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" name="city" placeholder="Enter City..." value="{{ request.GET.city|default:'' }}">
            </div>
        </div>

        <!-- Property Type -->
        <div class="filter-group">
            <h3>Property Type</h3>
            <div class="filter-options">
                <div class="option-item">
                    <input type="radio" name="property_type" id="apartment" value="APARTMENT" {% if request.GET.property_type == 'APARTMENT' %}checked{% endif %}>
                    <label for="apartment">Apartment</label>
                </div>
                <div class="option-item">
                    <input type="radio" name="property_type" id="villa" value="VILLA" {% if request.GET.property_type == 'VILLA' %}checked{% endif %}>
                    <label for="villa">Villa</label>
                </div>
                <div class="option-item">
                    <input type="radio" name="property_type" id="house" value="INDEPENDENT_HOUSE" {% if request.GET.property_type == 'INDEPENDENT_HOUSE' %}checked{% endif %}>
                    <label for="house">Independent House</label>
                </div>
                <div class="option-item">
                    <input type="radio" name="property_type" id="plot" value="PLOT" {% if request.GET.property_type == 'PLOT' %}checked{% endif %}>
                    <label for="plot">Plot / Land</label>
                </div>
                <div class="option-item">
                    <input type="radio" name="property_type" id="commercial" value="COMMERCIAL" {% if request.GET.property_type == 'COMMERCIAL' %}checked{% endif %}>
                    <label for="commercial">Commercial</label>
                </div>
            </div>
        </div>

        <!-- Budget -->
        <div class="filter-group">
            <h3>Budget</h3>
            <select name="budget">
                <option value="">Select Budget</option>
                <option value="Below 100k" {% if request.GET.budget == 'Below 100k' %}selected{% endif %}>Below 100k</option>
                <option value="100k - 300k" {% if request.GET.budget == '100k - 300k' %}selected{% endif %}>100k - 300k</option>
                <option value="Above 300k" {% if request.GET.budget == 'Above 300k' %}selected{% endif %}>Above 300k</option>
            </select>
        </div>

        <!-- Listing Type -->
        <div class="filter-group">
            <h3>Listing Type</h3>
            <div class="filter-options">
                <div class="option-item">
                    <input type="radio" name="listing_type" id="sale" value="sale" {% if request.GET.listing_type == 'sale' or not request.GET.listing_type %}checked{% endif %}>
                    <label for="sale">For Sale</label>
                </div>
                <div class="option-item">
                    <input type="radio" name="listing_type" id="rent" value="rent" {% if request.GET.listing_type == 'rent' %}checked{% endif %}>
                    <label for="rent">For Rent</label>
                </div>
            </div>
        </div>

        <button type="submit" class="filter-button">Apply Filters</button>
    </form>
</div>


            <!-- Property Listings -->
            <div class="property-listings">
                
                <div class="listings-header">
                   
                    <h2>{{ properties.paginator.count|default:"0" }} Properties Found</h2>
                 
                    <div class="sort-view">
                        <div class="sort-by">
                            <span>Sort by:</span>
                            <select id="sortSelect" onchange="updateSort()">
                                <option value="newest" {% if request.GET.sort == 'newest' or not request.GET.sort %}selected{% endif %}>Newest</option>
                                <option value="price_low" {% if request.GET.sort == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                                <option value="price_high" {% if request.GET.sort == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                            </select>
                        </div>
                        <div class="view-options">
                            <div class="view-option active">
                                <i class="fas fa-th"></i>
                            </div>
                            <div class="view-option">
                                <i class="fas fa-list"></i>
                            </div>
                        </div>
                    </div>
                </div>

                {% if properties %}
                <div class="properties-grid">
                  {% for prop in properties %}
                    <!-- Property 1 -->
                    <div class="property-card">
<div class="property-image">
    {% if prop.property_images_list and prop.property_images_list.0 %}
        <img src="{{ prop.property_images_list.0.image.url }}" alt="{{ prop.title }}">
    {% elif prop.main_image %}
        <img src="{{ prop.main_image.url }}" alt="{{ prop.title }}">
    {% else %}
        <div class="no-image-placeholder">
            <i class="fas fa-home"></i>
            <span>No Image Available</span>
        </div>
    {% endif %}
    <div class="property-badge">
        <span class="badge-type" style="background-color: #3b82f6;">
            <i class="fas fa-building"></i> {{ prop.property_type.name }}
        </span>
        {% if prop.is_featured %}
        <span class="badge-featured">Featured</span>
        {% endif %}
    </div>
</div>
                        <div class="property-content">
                             <h3 class="property-title">{{ prop.title }}</h3>
                            <div class="property-location">
                                <i class="fas fa-map-marker-alt"></i>
                                {{ prop.address }}, {{ prop.city }}
                            </div>
                            <!-- <div class="property-price">₹{{ prop.price }}</div> -->
                            <div class="property-details">
                                <div class="detail">
                                    <i class="fas fa-bed"></i>
                                    <span>{{ prop.bedrooms }} Beds</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-bath"></i>
                                    <span>{{ prop.bathrooms }} Baths</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-ruler-combined"></i>
                                    <span>{{ prop.area }} sq.ft</span>
                                </div>
                            </div>
                            <div class="property-actions">
                                <a href="{% url 'mck_website:property_detail' prop.id %}" class="view-details">View Details</a>
                                <button class="inquire-btn" data-property-id="{{ prop.id }}">Inquire Now</button>
                                <button class="favorite-btn">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                  {% endfor %}
                </div>
                
                <!-- Pagination -->
                <div class="pagination">
        {% if properties.has_previous %}
        <a href="?{% query_transform page=properties.previous_page_number %}" class="page-item">
            <i class="fas fa-chevron-left"></i>
        </a>
        {% endif %}
        
        {% for num in properties.paginator.page_range %}
            {% if properties.number == num %}
                <a href="?{% query_transform page=num %}" class="page-item active">{{ num }}</a>
            {% elif num > properties.number|add:'-3' and num < properties.number|add:'3' %}
                <a href="?{% query_transform page=num %}" class="page-item">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if properties.has_next %}
        <a href="?{% query_transform page=properties.next_page_number %}" class="page-item">
            <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
    </div>
                
                {% else %}
                <div class="no-properties">
                    <i class="fas fa-search"></i>
                    <h3>No properties found</h3>
                    <p>Try adjusting your search filters to find what you're looking for.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>


    <!-- Inquiry Modal -->
    <div class="modal" id="inquiryModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Property Inquiry</h3>
            <form id="heroEnquiryForm">
              {% csrf_token %}
                <input type="hidden" id="propertyId" name="property_id">
                <div class="form-group">
                    <input type="text" name="name" placeholder="Your Name" required>
                </div>
                <div class="form-group">
                    <input type="email" name="email" placeholder="Your Email" required>
                </div>
                <div class="form-group">
                    <input type="tel" name="phone" placeholder="Your Phone Number" required>
                </div>
                <div class="form-group">
                    <textarea name="message" placeholder="Your Message" rows="4"></textarea>
                </div>
                <button type="submit" class="submit-btn">
                  <i class="fas fa-paper-plane"></i> Submit
                </button>
                <div id="heroSuccessMessage" class="success-message">
                ✅ Your enquiry was submitted successfully!
              </div>
              <div id="heroErrorMessage" class="error-message">
                ❌ <span id="heroErrorText"></span>
              </div>
            </form>
        </div>
    </div>
    
    <!-- Why Choose Us Section -->
    <section class="why-choose-us">
        <div class="container">
            <h2>Why Choose SquareBox?</h2>
            <div class="features-grid">
                <div class="feature">
                    <i class="fas fa-check-circle"></i>
                    <h3>Verified Properties</h3>
                    <p>Every listing undergoes rigorous verification to ensure authenticity</p>
                </div>
                <div class="feature">
                    <i class="fas fa-rupee-sign"></i>
                    <h3>Best Price Guarantee</h3>
                    <p>We ensure you get the best market value for your investment</p>
                </div>
                <div class="feature">
                    <i class="fas fa-users"></i>
                    <h3>Expert Consultation</h3>
                    <p>Get advice from certified real estate professionals</p>
                </div>
                <div class="feature">
                    <i class="fas fa-file-contract"></i>
                    <h3>Legal Support</h3>
                    <p>End-to-end legal assistance for all property transactions</p>
                </div>
            </div>
        </div>
    </section>
    {% include "includes/property_type.html" %}

    <script>
        // Function to update URL parameters without reloading
        function updateQueryStringParameter(key, value) {
            const url = new URL(window.location);
            if (value) {
                url.searchParams.set(key, value);
            } else {
                url.searchParams.delete(key);
            }
            window.history.replaceState({}, '', url);
        }
        
        // Function to update sort parameter
        function updateSort() {
            const sortValue = document.getElementById('sortSelect').value;
            updateQueryStringParameter('sort', sortValue);
            window.location.reload();
        }
        
        // Reset filters function
        function resetFilters() {
            window.location.href = "{% url 'mck_website:mck_property_page' %}";
        }
  
        // Favorite button functionality
        document.querySelectorAll('.favorite-btn').forEach(button => {
            button.addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('far')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    this.style.color = '#e74c3c';
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    this.style.color = '';
                }
            });
        });

        // View options functionality
        document.querySelectorAll('.view-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.view-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                this.classList.add('active');
                
                // Here you would toggle between grid and list view
                const propertiesGrid = document.querySelector('.properties-grid');
                if (this.querySelector('i').classList.contains('fa-list')) {
                    propertiesGrid.style.gridTemplateColumns = '1fr';
                } else {
                    propertiesGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
                }
            });
        });

        // Range slider value display
        const rangeSlider = document.querySelector('.price-range');
        if (rangeSlider) {
            const rangeValues = document.querySelector('.range-values');
            
            rangeSlider.addEventListener('input', function() {
                const value = this.value;
                const max = this.max;
                const percent = (value / max) * 100;
                this.style.background = `linear-gradient(to right, #2563eb 0%, #2563eb ${percent}%, #e2e8f0 ${percent}%, #e2e8f0 100%)`;
                
                // Update displayed values
                if (value < 5000000) {
                    rangeValues.innerHTML = `<span>₹10L</span><span>₹${(value/100000).toFixed(1)}L</span>`;
                } else {
                    rangeValues.innerHTML = `<span>₹10L</span><span>₹${(value/10000000).toFixed(2)}Cr</span>`;
                }
            });
        }
        
        // Inquiry modal functionality
        const modal = document.getElementById('inquiryModal');
        const inquireButtons = document.querySelectorAll('.inquire-btn');
        const closeBtn = document.querySelector('.close');
        const propertyIdField = document.getElementById('propertyId');

        inquireButtons.forEach(button => {
            button.addEventListener('click', function() {
                const propertyId = this.getAttribute('data-property-id');
                propertyIdField.value = propertyId;
                modal.style.display = 'block';
            });
        });

        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });

        // Form submission
        document.getElementById('heroEnquiryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            submitBtn.disabled = true;
            
            document.getElementById('heroSuccessMessage').style.display = 'none';
            document.getElementById('heroErrorMessage').style.display = 'none';
            
            const formData = new FormData(this);
            
            fetch("{% url 'mck_website:mck_ajax_enquiry_save' %}", {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": getCSRFToken()
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    document.getElementById('heroSuccessMessage').style.display = "block";
                    this.reset();
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 2000);
                } else {
                    document.getElementById('heroErrorText').textContent = data.message || "There was an error submitting your enquiry";
                    document.getElementById('heroErrorMessage').style.display = "block";
                }
            })
            .catch(error => {
                document.getElementById('heroErrorText').textContent = "Network error. Please check your connection and try again.";
                document.getElementById('heroErrorMessage').style.display = "block";
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
        
        function getCSRFToken() {
            const name = "csrftoken";
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                const cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + "=")) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

   </script>
</body>
</html>
{% endblock %}